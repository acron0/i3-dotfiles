#!/bin/bash
[[ -z "$HETZNER_API_KEY" ]] && HETZNER_API_KEY=$(grep 'HETZNER_API_KEY' ~/.profile | sed 's/.*=//')

cpu=$(curl -s -H "Authorization: Bearer $HETZNER_API_KEY" \
  "https://api.hetzner.cloud/v1/servers/110490452/metrics?type=cpu&start=$(date -u -d '1 minute ago' +%Y-%m-%dT%H:%M:%SZ)&end=$(date -u +%Y-%m-%dT%H:%M:%SZ)" | \
  jq -r '.metrics.time_series.cpu.values[-1][1] | tonumber | . / 4 | floor')

# Line 1: full_text
echo "${cpu}%"
# Line 2: short_text
echo "${cpu}%"
# Line 3: color
if [ "$cpu" -gt 80 ]; then
    echo "#FF0000"
elif [ "$cpu" -gt 50 ]; then
    echo "#FFFF00"
fi
